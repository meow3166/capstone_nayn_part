{%include "include/header.html"%}
<main>
    <div class="game-date-picker" style="margin:10px 0;">
        <label for="gameDateInput"><b>Í≤ΩÍ∏∞ ÎÇ†Ïßú</b></label>
        <input id="gameDateInput" type="date" required>
    </div>
    <div class="scoreboard">
        <div class="result_admin">
            <p> Í≤ΩÍ∏∞Í≤∞Í≥º </p>
        </div>
        <p class="review"> Î¶¨Î∑∞ </p>
        <div class="result_table">
            <table border="1">
                <colgroup>
                    <col class="col-1"> <!-- 1Ïó¥: Ïäπ/Ìå® -->
                    <col class="col-2"> <!-- 2Ïó¥: Team A/B -->
                    <col class="col-rest" span="16"> <!-- 3~18Ïó¥: Î™®Îëê ÎèôÏùº ÎÑàÎπÑ -->
                </colgroup>

                <tr>
                    <td colspan="2" class="team">Team</td>
                    <td>1</td>
                    <td>2</td>
                    <td>3</td>
                    <td>4</td>
                    <td>5</td>
                    <td>6</td>
                    <td>7</td>
                    <td>8</td>
                    <td>9</td>
                    <td>10</td>
                    <td>11</td>
                    <td>12</td>
                    <td>R</td>
                    <td>H</td>
                    <td>E</td>
                    <td>B</td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
            </table>


        </div>
        <div class="result_table_bottom">
            <table border="1">
                <tr>
                    <td>Í≤∞ÏäπÌÉÄ</td>
                    <td></td>
                </tr>
                <tr>
                    <td>ÌôàÎü∞</td>
                    <td></td>
                </tr>
                <tr>
                    <td>3Î£®ÌÉÄ</td>
                    <td></td>
                </tr>
                <tr>
                    <td>2Î£®ÌÉÄ</td>
                    <td></td>
                </tr>
                <tr>
                    <td>Ïã§Ï±Ö</td>
                    <td></td>
                </tr>
                <tr>
                    <td>ÎèÑÎ£®</td>
                    <td></td>
                </tr>
                <tr>
                    <td>Ï£ºÎ£®ÏÇ¨</td>
                    <td></td>
                </tr>
                <tr>
                    <td>Î≥ëÏÇ¥ÌÉÄ</td>
                    <td></td>
                </tr>
                <tr>
                    <td>Ìè≠Ìà¨</td>
                    <td></td>
                </tr>
                <tr>
                    <td>Ïã¨Ìåê</td>
                    <td></td>
                </tr>
            </table>
        </div>

        <div class="teamA_hitter_result">
            <p> TeamA ÌÉÄÏûê Í∏∞Î°ù </p>
            <table border="1">
                <tr>
                    <td colspan="3">ÏÑ†ÏàòÎ™Ö</td>
                    <td>ÌÉÄÏàò</td>
                    <td>ÏïàÌÉÄ</td>
                    <td>ÌÉÄÏ†ê</td>
                    <td>ÎìùÏ†ê</td>
                    <td>ÌÉÄÏú®</td>
                </tr>
                <tr>
                    <td>1</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>2</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>3</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>4</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>5</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>6</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>7</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>8</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>9</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td colspan="3">Total</td>

                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
            </table>

        </div> <!-- teamA_hitter_result -->


        <div class="teamB_hitter_result">
            <p> TeamB ÌÉÄÏûê Í∏∞Î°ù </p>
            <table border="1">
                <tr>
                    <td colspan="3">ÏÑ†ÏàòÎ™Ö</td>
                    <td>ÌÉÄÏàò</td>
                    <td>ÏïàÌÉÄ</td>
                    <td>ÌÉÄÏ†ê</td>
                    <td>ÎìùÏ†ê</td>
                    <td>ÌÉÄÏú®</td>
                </tr>
                <tr>
                    <td>1</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>2</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>3</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>4</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>5</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>6</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>7</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>8</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>9</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td colspan="3">Total</td>

                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
            </table>
        </div> <!-- teamB_hitter_result -->


        <div class="teamA_pitcher_result">
            <p> TeamA Ìà¨Ïàò Í∏∞Î°ù </p>
            <table border="1">
                <tr>
                    <td>ÏÑ†ÏàòÎ™Ö</td>
                    <td>Îì±Ìåê</td>
                    <td>Í≤∞Í≥º</td>
                    <td>Ïäπ</td>
                    <td>Ìå®</td>
                    <td>ÏÑ∏</td>
                    <td>Ïù¥Îãù</td>
                    <td>ÌÉÄÏûê</td>
                    <td>Ìà¨Íµ¨Ïàò</td>
                    <td>ÌÉÄÏàò</td>
                    <td>ÌîºÏïàÌÉÄ</td>
                    <td>ÌôàÎü∞</td>
                    <td>4ÏÇ¨Íµ¨</td>
                    <td>ÏÇºÏßÑ</td>
                    <td>Ïã§Ï±Ö</td>
                    <td>ÏûêÏ±Ö</td>
                    <td>ERA</td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td colspan="6">Total</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
            </table>
        </div> <!-- teamA_pitcher_result -->


        <div class="teamB_pitcher_result">
            <p> TeamB Ìà¨Ïàò Í∏∞Î°ù </p>
            <table border="1">
                <tr>
                    <td>ÏÑ†ÏàòÎ™Ö</td>
                    <td>Îì±Ìåê</td>
                    <td>Í≤∞Í≥º</td>
                    <td>Ïäπ</td>
                    <td>Ìå®</td>
                    <td>ÏÑ∏</td>
                    <td>Ïù¥Îãù</td>
                    <td>ÌÉÄÏûê</td>
                    <td>Ìà¨Íµ¨Ïàò</td>
                    <td>ÌÉÄÏàò</td>
                    <td>ÌîºÏïàÌÉÄ</td>
                    <td>ÌôàÎü∞</td>
                    <td>4ÏÇ¨Íµ¨</td>
                    <td>ÏÇºÏßÑ</td>
                    <td>Ïã§Ï±Ö</td>
                    <td>ÏûêÏ±Ö</td>
                    <td>ERA</td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td colspan="6">Total</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
            </table>
        </div> <!-- teamB_pitcher_result -->
    </div>

    <div id="tableCtxMenu" class="ctx-menu">
        <button data-act="insert-above">ÌòÑÏû¨ Ìñâ ÏúÑÏóê Ï∂îÍ∞Ä</button>
        <button data-act="insert-below">ÌòÑÏû¨ Ìñâ ÏïÑÎûòÏóê Ï∂îÍ∞Ä</button>
        <button data-act="delete-row">ÌòÑÏû¨ Ìñâ ÏÇ≠Ï†ú</button>
    </div>

</main>
<footer></footer>
<!-- Î©îÎâ¥Î∞î js -->
<script src="./assets/js/menubar.js"></script>
<script>
    
    // function toggleMenu() {
    //     // document.querySelector(".member").classList.toggle("show");
    // }
    // const hamburger = document.querySelector('.hamburger');
    // const mainmenu = document.querySelector('.mainmenu');

    // hamburger.addEventListener('click', () => {
    //     mainmenu.classList.toggle('active');
    // });

    // // Î™®Î∞îÏùºÏóêÏÑú ÏÑúÎ∏å Î©îÎâ¥ ÌÅ¥Î¶≠ Ïãú ÏòÜÏúºÎ°ú ÌéºÏπòÍ∏∞ (Ìïú Î©îÎâ¥Îßå Ïó¥Î¶¨ÎèÑÎ°ù)
    // document.querySelectorAll('.mainmenu > li > a').forEach(item => {
    //     item.addEventListener('click', e => {
    //         if (window.innerWidth <= 768) { // Î™®Î∞îÏùºÏùº ÎïåÎßå
    //             e.preventDefault(); // ÎßÅÌÅ¨ Ïù¥Îèô Î∞©ÏßÄ
    //             const parentLi = item.parentElement;

    //             // Îã§Î•∏ liÏùò open ÌÅ¥ÎûòÏä§ Ï†úÍ±∞
    //             document.querySelectorAll('.mainmenu > li').forEach(li => {
    //                 if (li !== parentLi) {
    //                     li.classList.remove('open');
    //                 }
    //             });

    //             // ÌÅ¥Î¶≠Ìïú li toggle
    //             parentLi.classList.toggle('open');
    //         }
    //     });
    // });





    // Ïó¨Í∏∞ÏÑúÎ∂ÄÌÑ∞ Í∞í ÏûÖÎ†•





    // ============================
    // Í¥ÄÎ¶¨Ïûê ÌéòÏù¥ÏßÄ JS (ÏµúÏ¢Ö Ï†ïÎ¶¨Î≥∏: AUTO_INCREMENT ÎåÄÏùë)
    // ============================

    /* ---------- Í≥µÌÜµ ÏÉÅÌÉú ---------- */
    // URL ?id ÎòêÎäî localStorage('game_id') Í∏∞Ï§ÄÏúºÎ°ú ÌòÑÏû¨ Î¨∏ÏÑúÍ∞Ä Ìé∏Ïßë Ï§ëÏù∏ Î†àÏΩîÎìú ÏãùÎ≥Ñ

    /* =========================
       Í¥ÄÎ¶¨ÏûêÌéòÏù¥ÏßÄ JS (ÏµúÏ¢Ö Ï†ïÎ¶¨Î≥∏)
       - Ï≤òÏùå Ï†ÄÏû•: POST /api/game ‚Üí ÏÉà id Î∞úÍ∏â, URL ?id Í∞±Ïã†
       - Ïù¥ÌõÑ Ï†ÄÏû•: PUT  /api/game/:id
       - ÏßÑÏûÖ Ï¶âÏãú ÏûêÎèôÏ†ÄÏû• ÏóÜÏùå
       ========================= */

    /* ---------- ÌòÑÏû¨ id ---------- */
    // ÌéòÏù¥ÏßÄ Îß® ÏúÑ Ï¥àÍ∏∞Ìôî Î∂ÄÎ∂ÑÏóê Ï∂îÍ∞Ä(ÎòêÎäî ÍµêÏ≤¥)
    let CURRENT_ID = new URLSearchParams(location.search).get('id') || null;
    if (CURRENT_ID) {
        CURRENT_ID = String(CURRENT_ID);
        localStorage.setItem('game_id', CURRENT_ID);
    }


    /* ---------- Ïú†Ìã∏ ---------- */
    const qs = (sel, root = document) => root.querySelector(sel);
    const qsa = (sel, root = document) => Array.from(root.querySelectorAll(sel));
    const debounce = (fn, wait = 600) => { let t; return (...a) => { clearTimeout(t); t = setTimeout(() => fn(...a), wait); }; };
    const todayStr = () => {
        const d = new Date();
        return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;
    };

    /* ---------- Ìëú Ïú†Ìã∏ ---------- */
    function isTotalRow(tr) {
        const first = tr?.children?.[0];
        if (!first) return false;
        const label = (first.textContent || '').trim().toLowerCase();
        return (first.colSpan && first.colSpan > 1) || label === 'total';
    }
    function armCell(td) {
        td.contentEditable = 'true';
        td.spellcheck = false;
        td.style.outline = 'none';
        td.style.userSelect = 'text';
        td.setAttribute('tabindex', '0');
        ['input', 'blur', 'keyup', 'paste'].forEach(ev => {
            td.addEventListener(ev, () => {
                if (typeof window.applyTeamNames === 'function') window.applyTeamNames();
                if (typeof window.autoSave === 'function') window.autoSave();
            });
        });
    }

    // ÍµêÏ≤¥: td,th Î™®Îëê ÌôúÏÑ± + autosave Ïù¥Î≤§Ìä∏ Ïó∞Í≤∞
    function makeEditable(table, { skipHeader = true, skipCols = 0 } = {}) {
        if (!table) return;
        qsa('tr', table).forEach((tr, rIdx) => {
            if (skipHeader && rIdx === 0) return;
            qsa('td,th', tr).forEach((td, cIdx) => {
                if (cIdx < skipCols) return;
                armCell(td);
            });
        });
    }
    function tableToArray(table) {
        if (!table) return [];
        return qsa('tr', table).map(tr => qsa('td,th', tr).map(td => (td.textContent || '').trim()));
    }

    function fillTable(table, data) {
        if (!table || !Array.isArray(data)) return;
        const trs = qsa('tr', table);
        data.forEach((row, rIdx) => {
            if (!trs[rIdx]) return;
            const tds = qsa('td,th', trs[rIdx]);
            row.forEach((val, cIdx) => { if (tds[cIdx]) tds[cIdx].textContent = val; });
        });
    }
    function kvTableToPairs(table) {
        if (!table) return [];
        const pairs = [];
        qsa('tr', table).forEach(tr => {
            const cells = tr.querySelectorAll('td,th');
            if (cells.length >= 2) pairs.push([(cells[0].textContent || '').trim(), (cells[1].textContent || '').trim()]);
        });
        return pairs;
    }
    function fillKVTableFromPairs(table, pairs) {
        if (!table) return;
        const trs = table.querySelectorAll('tr');
        pairs.forEach((pair, i) => {
            const tr = trs[i]; if (!tr) return;
            const cells = tr.querySelectorAll('td,th');
            if (cells[0]) cells[0].textContent = pair[0] ?? '';
            if (cells[1]) cells[1].textContent = pair[1] ?? '';
        });
    }
    function extractRows(tableEl, headerRows = 1, removeTotal = false) {
        if (!tableEl) return { headerRows, rows: [] };
        const trs = Array.from(tableEl.querySelectorAll('tr'));
        const dataTrs = trs.slice(headerRows);
        if (removeTotal && dataTrs.length && isTotalRow(dataTrs[dataTrs.length - 1])) {
            dataTrs.pop();
        }
        const rows = dataTrs.map(tr => Array.from(tr.children).map(td => (td.textContent || '').trim()));
        return { headerRows, rows };
    }

    function makeSummaryEditable(table) {
        if (!table) return;
        const trs = qsa('tr', table);
        trs.forEach((tr, rIdx) => {
            // Ìó§ÎçîÍ∞Ä ÏóÜÎã§Î©¥ rIdx Ï°∞Í±¥ Ï†úÍ±∞Ìï¥ÎèÑ Îê®
            const cells = qsa('td,th', tr);
            cells.forEach((cell, cIdx) => {
                if (cIdx === 1) armCell(cell); // Í∞í Ïπ∏Îßå Ìé∏Ïßë
                else {
                    cell.contentEditable = 'false';
                    cell.removeAttribute('tabindex');
                }
            });
        });
    }

    /* ---------- ÏàòÏßë ---------- */
    function collectFourTablesSnapshot() {
        const hitterA = qs('.teamA_hitter_result table');
        const hitterB = qs('.teamB_hitter_result table');
        const pitcherA = qs('.teamA_pitcher_result table');
        const pitcherB = qs('.teamB_pitcher_result table');
        return {
            tables: {
                hitterA: extractRows(hitterA, 1, false),   // ‚Üê Total Ïú†ÏßÄ
                hitterB: extractRows(hitterB, 1, false),
                pitcherA: extractRows(pitcherA, 1, false),
                pitcherB: extractRows(pitcherB, 1, false),
            }
        };
    }
    function collectTeamNames() {
        const scoreTable = qs('.result_table table');
        if (!scoreTable) return { teamAName: 'TeamA', teamBName: 'TeamB' };
        const rows = scoreTable.querySelectorAll('tr');
        const pick = (row) => {
            if (!row) return '';
            const cell = row.querySelector('td:nth-child(2), th:nth-child(2)') || row.querySelector('td,th');
            return (cell?.textContent || '').trim();
        };
        return {
            teamAName: pick(rows[1]) || 'TeamA',
            teamBName: pick(rows[2]) || 'TeamB',
        };
    }


    function collectScoreTable() {
        return tableToArray(qs('.result_table table')); // td,th Î™®Îëê ÏàòÏßë
    }
    function collectSummaryPairs() {
        return kvTableToPairs(qs('.result_table_bottom table'));
    }

    function collectScoreTableRowsOnly() {
        const tbl = qs('.result_table table');
        if (!tbl) return [];
        const arr = tableToArray(tbl); // Ìó§Îçî Ìè¨Ìï® ÏÉÅÌÉúÏùº Ïàò ÏûàÏùå
        const hasHeader = !!tbl.querySelector('tr th');
        return hasHeader ? arr.slice(1) : arr; // ‚òÖ Ìó§Îçî 1Ìñâ Ï†úÍ±∞
    }

    function collectSummaryPairs() {
        return kvTableToPairs(qs('.result_table_bottom table'));
    }

    function buildPayload(dateOverride) {
        const gameDate = dateOverride || (qs('#gameDateInput')?.value?.trim() || qs('#gameDate')?.value?.trim() || todayStr());
        const { teamAName, teamBName } = collectTeamNames();
        const snap4 = collectFourTablesSnapshot();

        const scoreTable = collectScoreTableRowsOnly(); // ‚òÖ Îç∞Ïù¥ÌÑ∞ ÌñâÎßå
        const summaryTable = collectSummaryPairs();       // ‚òÖ [ÌÇ§,Í∞í] Î∞∞Ïó¥

        return {
            gameDate, teamAName, teamBName,
            scoreTable,            // ‚òÖ Ìè¨Ìï®
            summaryTable,          // ‚òÖ Ìè¨Ìï®
            ...snap4,              // tables.hitterA/B/pitcherA/B
            savedAt: new Date().toISOString()
        };
    }


    /* ---------- DOM Ï∞∏Ï°∞ ---------- */
    const scoreTableEl = qs('.result_table table');
    const summaryTableEl = qs('.result_table_bottom table');
    const teamA_hitterEl = qs('.teamA_hitter_result table');
    const teamB_hitterEl = qs('.teamB_hitter_result table');
    const teamA_pitcherEl = qs('.teamA_pitcher_result table');
    const teamB_pitcherEl = qs('.teamB_pitcher_result table');

    /* ---------- ÏÑúÎ≤Ñ ÌÜµÏã† ---------- */
    async function createGame(payload) {
        const res = await fetch('/api/game', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload),
        });
        let json = {};
        try { json = await res.json(); } catch (_) { }

        if (!res.ok || !json?.id) {
            const msg = json?.error || `CREATE Ïã§Ìå® (status ${res.status})`;
            throw new Error(msg);
        }

        CURRENT_ID = String(json.id);
        localStorage.setItem('game_id', CURRENT_ID);
        history.replaceState(null, '', `?id=${encodeURIComponent(CURRENT_ID)}`);
        return json.id;
    }


    async function updateGame(id, payload) {
        // ‚úÖ PUTÏóêÎäî ÎÇ†ÏßúÎ•º Ïã£ÏßÄ ÏïäÏùå (ÏÑúÎ≤ÑÎèÑ Í±∞Î∂ÄÌïòÏßÄÎßå, ÌÅ¥ÎùºÏóêÏÑú Î®ºÏ†Ä Î∞©Ïñ¥)
        const safe = { ...payload };
        if ('gameDate' in safe) delete safe.gameDate;
        if ('game_date' in safe) delete safe.game_date;

        const res = await fetch(`/api/game/${id}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(safe),
        });

        let json = {};
        try { json = await res.json(); } catch (_) { }

        if (res.status === 404) return { notFound: true };
        if (res.status === 409) {
            // ÎÇ†Ïßú Î∂àÏùºÏπòÎ°ú ÏÑúÎ≤ÑÍ∞Ä ÎßâÏùÄ Í≤ΩÏö∞: ÏûêÎèôÏ†ÄÏû• Îì±ÏóêÏÑú Ïò® ÏûòÎ™ªÎêú Ìò∏Ï∂ú
            console.warn('PUT blocked due to date_mismatch. Ignore autosave.');
            return { ok: false, blocked: true, reason: 'date_mismatch' };
        }
        if (!res.ok || json?.ok === false) {
            const msg = json?.error || `UPDATE Ïã§Ìå® (status ${res.status})`;
            throw new Error(msg);
        }
        return { ok: true };
    }

    async function getGameMeta(id) {
        try {
            const res = await fetch(`/api/game/${id}`, { cache: 'no-store' });
            if (!res.ok) return null;
            return await res.json(); // { gameDate, ... }
        } catch { return null; }
    }

    async function saveSnapshot(payload, { silent = false, allowNewOnDateChange = true } = {}) {
        // ÎÇ†Ïßú Î¨∏ÏûêÏó¥Îßå ÎπÑÍµê(Y-m-dÎßå ÎπÑÍµêÌïòÎèÑÎ°ù Ïä¨ÎùºÏù¥Ïä§)
        const newDate = (payload.gameDate || '').slice(0, 10);

        if (CURRENT_ID) {
            const meta = await getGameMeta(CURRENT_ID); // Í∏∞Ï°¥ Ï†ÄÏû•Î≥∏
            const oldDate = (meta?.gameDate || '').slice(0, 10);

            // ‚úÖ ÎÇ†ÏßúÍ∞Ä Îã§Î•¥Î©¥: Í∞ôÏùÄ IDÏóê ÎçÆÏñ¥Ïì∞ÏßÄ ÎßêÍ≥† ÏÉàÎ°ú ÏÉùÏÑ±
            if (allowNewOnDateChange && oldDate && newDate && oldDate !== newDate) {
                CURRENT_ID = null;
                localStorage.removeItem('game_id');
                const newId = await createGame(payload); // POST ‚Üí ÏÉà id
                if (!silent) alert(`Ï†ÄÏû• ÏôÑÎ£å (ÏÉà ID: ${newId})`);
                return;
            }

            // ÎÇ†ÏßúÍ∞Ä Í∞ôÏúºÎ©¥ Í∏∞Ï°¥ IDÏóê ÏóÖÎç∞Ïù¥Ìä∏
            const res = await updateGame(CURRENT_ID, payload);
            if (res.status === 404) { // Ï£ºÏÜåÏóî id ÏûàÎäîÎç∞ dbÏóî ÏóÜÏùå ‚Üí ÏÉàÎ°ú ÏÉùÏÑ±
                const newId = await createGame(payload);
                if (!silent) alert(`Ï†ÄÏû• ÏôÑÎ£å (ÏÉà ID: ${newId})`);
                return;
            }
            if (!silent) alert('Ï†ÄÏû• ÏôÑÎ£å');
            return;
        }

        // CURRENT_IDÍ∞Ä ÏóÜÏúºÎ©¥ ÏÉàÎ°ú ÏÉùÏÑ±
        const newId = await createGame(payload);
        if (!silent) alert(`Ï†ÄÏû• ÏôÑÎ£å (ÏÉà ID: ${newId})`);
    }



    // async function loadData() {
    //     if (!CURRENT_ID) { alert('Î∂àÎü¨Ïò¨ idÍ∞Ä ÏóÜÏäµÎãàÎã§. Î®ºÏ†Ä Ï†ÄÏû•ÌïòÏÑ∏Ïöî.'); return; }
    //     const res = await fetch(`/api/game/${CURRENT_ID}`, { cache: 'no-store' });
    //     if (!res.ok) { alert('Ï†ÄÏû•Îêú Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.'); return; }
    //     const data = await res.json();

    //     const dateInput = qs('#gameDateInput') || qs('#gameDate');
    //     if (data.gameDate) dateInput && (dateInput.value = data.gameDate);

    //     if (data.scoreTable) fillTable(scoreTableEl, data.scoreTable);

    //     if (Array.isArray(data.summaryTable)) {
    //         fillKVTableFromPairs(summaryTableEl, data.summaryTable);
    //     } else if (data.summaryTable && typeof data.summaryTable === 'object') {
    //         const pairs = Array.from(summaryTableEl.querySelectorAll('tr')).map(tr => {
    //             const key = tr.querySelectorAll('td,th')[0]?.textContent.trim() || '';
    //             const val = data.summaryTable[key] ?? '';
    //             return [key, val];
    //         });
    //         fillKVTableFromPairs(summaryTableEl, pairs);
    //     }

    //     if (data.teamA_hitter) fillTable(teamA_hitterEl, data.teamA_hitter);
    //     if (data.teamB_hitter) fillTable(teamB_hitterEl, data.teamB_hitter);
    //     if (data.teamA_pitcher) fillTable(teamA_pitcherEl, data.teamA_pitcher);
    //     if (data.teamB_pitcher) fillTable(teamB_pitcherEl, data.teamB_pitcher);

    //     alert('üìÑ Îç∞Ïù¥ÌÑ∞ Î∂àÎü¨Ïò§Í∏∞ ÏôÑÎ£å');
    // }


    async function loadData() {
        // 0) URLÏùò ?idÎ•º ÏµúÏö∞ÏÑ†ÏúºÎ°ú ÏÇ¨Ïö©ÌïòÍ≥†, ÏûàÏúºÎ©¥ CURRENT_ID Í∞±Ïã†
        const urlId = new URLSearchParams(location.search).get('id');
        if (urlId) CURRENT_ID = String(urlId);

        if (!CURRENT_ID) { alert('Î∂àÎü¨Ïò¨ idÍ∞Ä ÏóÜÏäµÎãàÎã§. Î®ºÏ†Ä Ï†ÄÏû•ÌïòÏÑ∏Ïöî.'); return; }

        // 1) Ï∫êÏãú Î¨¥Ìö®Ìôî + no-store
        const res = await fetch(`/api/game/${encodeURIComponent(CURRENT_ID)}?t=${Date.now()}`, { cache: 'no-store' });
        if (!res.ok) { alert('Ï†ÄÏû•Îêú Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.'); return; }
        const raw = await res.json();

        // 2) ÏùëÎãµ ÌòïÌÉú Ï†ïÍ∑úÌôî: { ok, id, gameDate, ...payload } or { gameDate, payload:{...} } or row.payload=string
        let data = raw;
        if (raw && typeof raw === 'object') {
            if ('payload' in raw && raw.payload && typeof raw.payload === 'string') {
                try { raw.payload = JSON.parse(raw.payload); } catch { }
            }
            if (raw && raw.payload && typeof raw.payload === 'object') {
                // ÏÑúÎ≤ÑÍ∞Ä { ok, id, gameDate, ...payload } ÌòïÌÉúÍ∞Ä ÏïÑÎãàÎùº { gameDate, payload:{...} } Î°ú Ï£ºÎäî Í≤ΩÏö∞ payloadÎ•º ÌéºÏπ®
                data = { gameDate: raw.gameDate ?? raw.payload.gameDate, ...raw.payload };
            }
        }

        // 3) ÌôîÎ©¥ Ï¥àÍ∏∞Ìôî(Ïù¥Ï†Ñ id ÎÇ¥Ïö© ÏûîÏ°¥ Î∞©ÏßÄ)
        try {
            // ÌÖåÏù¥Î∏î/ÏûÖÎ†• Ï¥àÍ∏∞Ìôî Ìó¨ÌçºÍ∞Ä ÏûàÏúºÎ©¥ ÏÇ¨Ïö©, ÏóÜÏúºÎ©¥ Í∞ÑÎã® Ï¥àÍ∏∞Ìôî
            const simpleClearTable = (el) => {
                if (!el) return;
                const rows = el.querySelectorAll('tr');
                rows.forEach((tr, i) => {
                    const cells = tr.querySelectorAll('td,th');
                    // Ìó§ÎçîÎäî Î≥¥Ï°¥, Îç∞Ïù¥ÌÑ∞ÏÖÄ ÎπÑÏö∞Í∏∞
                    cells.forEach((cell, ci) => {
                        if (cell.tagName === 'TD') cell.textContent = '';
                        // ÌïÑÏöîÏãú input ÏöîÏÜå Ï¥àÍ∏∞Ìôî
                        const inp = cell.querySelector('input,textarea');
                        if (inp) inp.value = '';
                    });
                });
            };
            const simpleClearKV = (el) => {
                if (!el) return;
                const rows = el.querySelectorAll('tr');
                rows.forEach(tr => {
                    const tds = tr.querySelectorAll('td,th');
                    if (tds.length >= 2) {
                        const valCell = tds[1];
                        valCell.textContent = '';
                        const inp = valCell.querySelector('input,textarea');
                        if (inp) inp.value = '';
                    }
                });
            };

            // Ïã§Ï†ú ÏóòÎ¶¨Î®ºÌä∏ Î≥ÄÏàòÎ™ÖÏùÄ ÎÑàÍ∞Ä Ïù¥ÎØ∏ Í∞ñÍ≥† ÏûàÎäî Í±∏ ÏÇ¨Ïö©
            simpleClearTable(scoreTableEl);
            simpleClearKV(summaryTableEl);
            simpleClearTable(teamA_hitterEl);
            simpleClearTable(teamB_hitterEl);
            simpleClearTable(teamA_pitcherEl);
            simpleClearTable(teamB_pitcherEl);
        } catch (e) {
            console.warn('[loadData] clear UI skipped:', e);
        }

        // 4) ÎÇ†Ïßú ÏûÖÎ†• ÏÑ§Ï†ï
        const dateInput = qs('#gameDateInput') || qs('#gameDate');
        const normalizedDate = (data.gameDate || '').slice(0, 10); // 'YYYY-MM-DD'
        if (dateInput && normalizedDate) dateInput.value = normalizedDate;

        // 5) Ìëú/ÏÑπÏÖò Ï£ºÏûÖ
        //  - ÎÑ§ Í∏∞Ï°¥ Ìó¨Ìçº(fillTable, fillKVTableFromPairs)Î•º Í∑∏ÎåÄÎ°ú ÏÇ¨Ïö©
        if (data.scoreTable) fillTable(scoreTableEl, data.scoreTable);

        if (Array.isArray(data.summaryTable)) {
            fillKVTableFromPairs(summaryTableEl, data.summaryTable);
        } else if (data.summaryTable && typeof data.summaryTable === 'object') {
            const pairs = Array.from(summaryTableEl.querySelectorAll('tr')).map(tr => {
                const key = tr.querySelectorAll('td,th')[0]?.textContent.trim() || '';
                const val = data.summaryTable[key] ?? '';
                return [key, val];
            });
            fillKVTableFromPairs(summaryTableEl, pairs);
        }

        if (data.teamA_hitter) fillTable(teamA_hitterEl, data.teamA_hitter);
        if (data.teamB_hitter) fillTable(teamB_hitterEl, data.teamB_hitter);
        if (data.teamA_pitcher) fillTable(teamA_pitcherEl, data.teamA_pitcher);
        if (data.teamB_pitcher) fillTable(teamB_pitcherEl, data.teamB_pitcher);

        // 6) ÏµúÏ¢Ö ÌôïÏù∏Ïö© Î°úÍ∑∏
        console.log('[loadData] loaded id=', CURRENT_ID, 'date=', normalizedDate, data);

        alert('üìÑ Îç∞Ïù¥ÌÑ∞ Î∂àÎü¨Ïò§Í∏∞ ÏôÑÎ£å');
    }


    /* ---------- Í¥ÄÎ¶¨Ïûê Î∞î (Î≤ÑÌäºÎßå ÏÉùÏÑ±, Ïù¥Î≤§Ìä∏Îäî Î≥ÑÎèÑ) ---------- */
    function setupAdminBar() {
        if (document.querySelector('.admin-bar')) return;
        const bar = document.createElement('div');
        bar.className = 'admin-bar';
        bar.style = 'position:sticky;top:0;padding:10px;background:#fff8c4;border:1px solid #ccc;z-index:999;';
        bar.innerHTML = `
    <b>Í¥ÄÎ¶¨Ïûê Î™®Îìú</b>
    <button id="loadBtn" style="margin-left:10px;" type="button">Î∂àÎü¨Ïò§Í∏∞</button>
    <button id="saveBtn" style="margin-left:10px;" type="button">Ï†ÄÏû•</button>
  `;
        qs('.scoreboard')?.before(bar);
    }

    /* ---------- ÌåÄÎ™Ö Î∞òÏòÅ + ÏûêÎèôÏ†ÄÏû•(ÏûÖÎ†• ÏãúÏóêÎßå) ---------- */
    window.applyTeamNames = () => { };
    (function setupTeamnameAndAutosave() {
        if (!scoreTableEl) return;
        const rows = scoreTableEl.querySelectorAll('tr');

        function getTeamNameFromRow(row) {
            if (!row) return '';
            const cell = row.querySelector('td:nth-child(2), th:nth-child(2)') || row.querySelector('td,th');
            return (cell?.textContent || '').trim();
        }

        window.autoSave = debounce(async () => {
            try {
                await saveSnapshot(buildPayload(), { silent: true, allowNewOnDateChange: false }); // ‚Üê ÏûêÎèôÏ†ÄÏû•: ÏÉàÎ°ú Ïïà ÎßåÎì¶
            } catch (e) { console.warn('ÏûêÎèô Ï†ÄÏû• Ïã§Ìå®:', e); }
        }, 800);



        window.applyTeamNames = () => {
            const teamA = getTeamNameFromRow(rows[1]) || 'TeamA';
            const teamB = getTeamNameFromRow(rows[2]) || 'TeamB';
            qsa('.teamA_hitter_result p').forEach(el => el.textContent = `${teamA} ÌÉÄÏûê Í∏∞Î°ù`);
            qsa('.teamB_hitter_result p').forEach(el => el.textContent = `${teamB} ÌÉÄÏûê Í∏∞Î°ù`);
            qsa('.teamA_pitcher_result p').forEach(el => el.textContent = `${teamA} Ìà¨Ïàò Í∏∞Î°ù`);
            qsa('.teamB_pitcher_result p').forEach(el => el.textContent = `${teamB} Ìà¨Ïàò Í∏∞Î°ù`);
            // Ï¥àÍ∏∞ ÏßÑÏûÖ Ïãú ÏûêÎèô Ìò∏Ï∂ú ÏóÜÏùå (ÏûÖÎ†• Ïù¥Î≤§Ìä∏ÏóêÏÑúÎßå Ìò∏Ï∂ú)
        };

        [1, 2].forEach((rIdx) => {
            const tds = rows[rIdx]?.querySelectorAll('td,th');
            if (!tds) return;
            tds.forEach((cell) => {
                cell.contentEditable = 'true';
                cell.style.outline = 'none';
                cell.spellcheck = false;
                ['input', 'blur', 'keyup', 'paste'].forEach(evt => {
                    cell.addEventListener(evt, () => {
                        window.applyTeamNames();
                        window.autoSave();
                    });
                });
            });
        });
    })();

    /* ---------- Í∏∞Î≥∏ Ìé∏Ïßë Í∞ÄÎä• ÏòÅÏó≠ ---------- */
    makeEditable(scoreTableEl, { skipHeader: true, skipCols: 2 });
    makeEditable(teamA_hitterEl, { skipHeader: true, skipCols: 3 });
    makeEditable(teamB_hitterEl, { skipHeader: true, skipCols: 3 });
    makeEditable(teamA_pitcherEl, { skipHeader: true, skipCols: 1 });
    makeEditable(teamB_pitcherEl, { skipHeader: true, skipCols: 1 });

    makeSummaryEditable(summaryTableEl);

    /* ---------- Ï¥àÍ∏∞Ìôî(ÏòµÏÖò no-op) ---------- */
    function clearScoreTable() { }
    function clearSummaryTable() { }
    function clearHitterTable(tbl) { }
    function clearPitcherTable(tbl) { }
    function resetAdminPageToEmpty() {
        const dateInput = qs('#gameDateInput') || qs('#gameDate');
        if (dateInput) dateInput.value = '';
        clearScoreTable(); clearSummaryTable();
        clearHitterTable(teamA_hitterEl); clearHitterTable(teamB_hitterEl);
        clearPitcherTable(teamA_pitcherEl); clearPitcherTable(teamB_pitcherEl);
    }

    /* ---------- Ïö∞ÌÅ¥Î¶≠ Ïª®ÌÖçÏä§Ìä∏ Î©îÎâ¥ ---------- */
    (() => {
        const editableTables = document.querySelectorAll(
            '.result_table table, .teamA_hitter_result table, .teamB_hitter_result table, .teamA_pitcher_result table, .teamB_pitcher_result table'
        );
        const menu = document.getElementById('tableCtxMenu');
        if (!menu) return;

        let targetCell = null;

        const armCell = (td) => {
            td.contentEditable = 'true';
            td.style.outline = 'none';
            td.spellcheck = false;
            ['input', 'blur', 'keyup', 'paste'].forEach(ev => {
                td.addEventListener(ev, () => {
                    if (typeof window.applyTeamNames === 'function') window.applyTeamNames();
                    if (typeof window.autoSave === 'function') window.autoSave();
                });
            });
        };

        const cellInfo = (cell) => {
            const tr = cell.closest('tr');
            const table = cell.closest('table');
            const section = tr.parentNode; // THEAD/TBODY/TFOOT
            const rows = Array.from(section.children).filter(el => el.tagName === 'TR');
            const rowIndex = rows.indexOf(tr);
            return { table, section, tr, rowIndex, cols: tr.cells.length };
        };

        const insertRow = (info, where = 'below') => {
            const { section, rowIndex, cols } = info;
            const idx = (where === 'above' ? rowIndex : rowIndex + 1);
            const newTr = section.insertRow(idx);
            for (let i = 0; i < cols; i++) {
                const td = newTr.insertCell(-1);
                td.textContent = '';
                armCell(td);
            }
        };

        const deleteRow = (info) => {
            const { section, rowIndex } = info;
            if (section.tagName === 'THEAD') return alert('Ìó§Îçî ÌñâÏùÄ ÏÇ≠Ï†úÌï† Ïàò ÏóÜÏñ¥Ïöî.');
            section.deleteRow(rowIndex);
        };

        editableTables.forEach(tbl => {
            tbl.addEventListener('contextmenu', (e) => {
                const cell = e.target.closest('td,th');
                if (!cell || !tbl.contains(cell)) return;
                e.preventDefault();
                targetCell = cell;
                const { clientX: x, clientY: y } = e;
                menu.style.left = x + 'px';
                menu.style.top = y + 'px';
                menu.style.display = 'block';
            });
        });

        menu.addEventListener('click', (e) => {
            const act = e.target?.dataset?.act;
            if (!act || !targetCell) return;
            const info = cellInfo(targetCell);
            if (act === 'insert-above') insertRow(info, 'above');
            if (act === 'insert-below') insertRow(info, 'below');
            if (act === 'delete-row') deleteRow(info);

            if (typeof window.applyTeamNames === 'function') window.applyTeamNames();
            if (typeof window.autoSave === 'function') window.autoSave();

            menu.style.display = 'none';
            targetCell = null;
        });

        document.addEventListener('click', (e) => {
            if (!menu.contains(e.target)) { menu.style.display = 'none'; targetCell = null; }
        });
        window.addEventListener('scroll', () => menu.style.display = 'none');
        window.addEventListener('resize', () => menu.style.display = 'none');

        editableTables.forEach(tbl => tbl.querySelectorAll('td,th').forEach(armCell));
    })();

    /* ---------- ÏãúÏûë ---------- */
    document.addEventListener('DOMContentLoaded', () => {
        setupAdminBar();
        const loadBtn = document.getElementById('loadBtn');
        const saveBtn = document.getElementById('saveBtn');

        if (loadBtn && !loadBtn.__bound) {
            loadBtn.__bound = true;
            loadBtn.addEventListener('click', loadData);
        }

        if (saveBtn && !saveBtn.__bound) {
            saveBtn.__bound = true;
            if (!saveBtn.getAttribute('type')) saveBtn.setAttribute('type', 'button');

            // ‚úÖ Ï†ÄÏû• Î≤ÑÌäº: Í∞ôÏùÄ ÎÇ†ÏßúÎ©¥ ÎçÆÏñ¥Ïì∞Í∏∞ / Îã§Î•∏ ÎÇ†ÏßúÎ©¥ ÏÉàÎ°ú Ï∂îÍ∞Ä (Ìï≠ÏÉÅ POST)
            saveBtn.addEventListener('click', async (e) => {
                e.preventDefault();
                e.stopPropagation();

                // 1Ô∏è‚É£ ÎÇ†Ïßú Í∞ÄÏ†∏Ïò§Í∏∞
                const dateInput = qs('#gameDateInput') || qs('#gameDate');
                const gameDate = dateInput?.value?.trim();

                if (!gameDate) {
                    alert('ÎÇ†ÏßúÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî');
                    dateInput?.focus();
                    return;
                }

                try {
                    // 2Ô∏è‚É£ ÌôîÎ©¥ÏóêÏÑú Ï†ÑÏ≤¥ Îç∞Ïù¥ÌÑ∞ ÏàòÏßë
                    // buildPayloadÎäî Í∏∞Ï°¥ Ìï®Ïàò Í∑∏ÎåÄÎ°ú ÏÇ¨Ïö© (Ï†ÑÏ≤¥ ÌÖåÏù¥Î∏î JSON Î∞òÌôò)
                    const dataObj = buildPayload(gameDate);

                    // 3Ô∏è‚É£ ÏÑúÎ≤ÑÎ°ú Î≥¥ÎÇº ÌéòÏù¥Î°úÎìú (ÎÇ†Ïßú Î∞òÎìúÏãú Ìè¨Ìï®)
                    const payloadToSend = {
                        gameDate,          // ÎÇ†Ïßú Í∏∞Ï§ÄÏúºÎ°ú ÏóÖÏÑúÌä∏
                        payload: dataObj   // Í≤ΩÍ∏∞ Í≤∞Í≥º Ï†ÑÏ≤¥ Îç∞Ïù¥ÌÑ∞(JSON)
                    };

                    // 4Ô∏è‚É£ Ìï≠ÏÉÅ POST (Í∞ôÏùÄ ÎÇ†ÏßúÎ©¥ ÎçÆÏñ¥Ïì∞Í∏∞, Îã§Î•∏ ÎÇ†ÏßúÎ©¥ ÏÉàÎ°ú Ï∂îÍ∞Ä)
                    console.log('[SAVE ‚Üí POST /api/game]', payloadToSend);
                    const newId = await createGame(payloadToSend);

                    // 5Ô∏è‚É£ ÏÑ±Í≥µ Ï≤òÎ¶¨
                    alert(`Ï†ÄÏû• ÏôÑÎ£å! (ID: ${newId})`);
                    console.log('[POST ÏôÑÎ£å] ID:', newId);

                    // ‚úÖ localStorage Î∞è URL Í∞±Ïã† (createGame ÎÇ¥Î∂ÄÏóêÏÑú ÏûêÎèô Ï≤òÎ¶¨)
                    // ÌïÑÏöî Ïãú CURRENT_ID ÌôïÏù∏Ïö© Î°úÍ∑∏
                    console.log('CURRENT_ID:', CURRENT_ID);

                } catch (err) {
                    console.error('[SAVE ERROR]', err);
                    alert('Ï†ÄÏû• Ïã§Ìå®: ' + (err.message || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'));
                }
            });
        }
    });




</script>

</body>

</html>